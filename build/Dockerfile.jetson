# build/Dockerfile.jetson
ARG L4T_TAG=r36.2.0
FROM nvcr.io/nvidia/l4t-base:${L4T_TAG}

ENV NVIDIA_VISIBLE_DEVICES=all
ENV NVIDIA_DRIVER_CAPABILITIES=compute,utility

RUN apt-get update && apt-get install -y --no-install-recommends \
    python3 python3-pip python3-venv python3-dev \
    git build-essential cmake ninja-build \
    libprotobuf-dev protobuf-compiler \
    libcurl4-openssl-dev \
    && rm -rf /var/lib/apt/lists/*

RUN update-alternatives --install /usr/bin/python python /usr/bin/python3 1
WORKDIR /workspace
COPY . /workspace

# Core python deps
RUN python3 -m pip install --no-cache-dir --upgrade pip setuptools wheel \
 && python3 -m pip install --no-cache-dir numpy onnx onnxsim transformers tokenizers requests \
 && git clone --depth 1 https://github.com/NVIDIA/TensorRT-LLM.git /workspace/TensorRT-LLM \
 && python3 -m pip install --no-cache-dir -r /workspace/TensorRT-LLM/requirements.txt \
 && python3 -m pip install --no-cache-dir -e /workspace/TensorRT-LLM
